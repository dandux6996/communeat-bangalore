<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Commun-Eat-Y</title>
  <meta name="description" content="Explore restaurants in Bangalore under Collection and Community categories.">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary-color: #D72638;
      --accent-color: #FFFFFF;
      --neutral-color: #2E2E2E;
      --bg-color: #FFF7F0;
      --text-color: var(--neutral-color);
    }
    *, *::before, *::after { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Poppins', sans-serif;
      background: var(--bg-color);
      color: var(--text-color);
      position: relative;
      overflow-x: hidden;
    }
    header {
      position: relative;
      background: url('https://myloveofbaking.com/wp-content/uploads/2023/06/IMG_9500.jpg') center/cover no-repeat;
      color: var(--accent-color);
      text-align: center;
      padding: 10rem 1rem 4rem;
      min-height: 600px;
    }
    header::after {
      content: '';
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 0;
    }
    header h1, header p {
      position: relative;
      z-index: 1;
      margin: 0;
    }
    header h1 {
      font-size: 4rem;
      font-weight: 700;
      letter-spacing: 1px;
    }
    .tagline {
      margin-top: 1rem;
      font-size: 1.5rem;
      font-weight: 300;
    }
    main {
      max-width: 880px;
      margin: 3rem auto;
      padding: 0 1rem;
      position: relative;
    }
    .categories {
      display: flex;
      justify-content: center;
      gap: 2rem;
      margin-bottom: 2rem;
    }
    .categories h2 {
      margin: 0;
      padding-bottom: 0.25rem;
      cursor: pointer;
      border-bottom: 2px solid transparent;
      transition: border-color 0.3s, color 0.3s;
      font-weight: 500;
      color: var(--neutral-color);
    }
    .categories h2:hover {
      border-color: var(--primary-color);
      color: var(--primary-color);
    }
    .search-section {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 3rem;
    }
    .search-section input {
      flex: 1;
      padding: 1rem;
      font-size: 1rem;
      border: 2px solid var(--neutral-color);
      border-radius: 4px;
      transition: border-color 0.3s;
    }
    .search-section input:focus {
      outline: none;
      border-color: var(--primary-color);
    }
    .search-section button {
      padding: 1rem 2rem;
      font-size: 1rem;
      border: none;
      background: var(--primary-color);
      color: var(--accent-color);
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.2s, transform 0.2s;
    }
    .search-section button:hover {
      background: #b41c2d;
      transform: translateY(-2px);
    }
    #results {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 1rem;
      margin-bottom: 4rem;
    }
    .restaurant {
      background: var(--accent-color);
      padding: 1.25rem;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      color: var(--neutral-color);
      transition: transform 0.2s;
    }
    .restaurant:hover {
      transform: translateY(-4px);
    }
    .restaurant h3 {
      margin: 0 0 0.5rem;
      font-size: 1.2rem;
    }
    .restaurant p {
      margin: 0.25rem 0;
      font-size: 0.95rem;
    }
    .error {
      grid-column: 1 / -1;
      color: red;
      text-align: center;
    }
    @media (max-width: 768px) {
      header { padding: 6rem 1rem 2rem; }
      header h1 { font-size: 2.5rem; }
    }
  </style>
  <script>
    window.gm_authFailure = function() { displayError('Authentication error: check your API key.'); };

    function displayError(msg) {
      document.getElementById('results').innerHTML = `<p class="error">${msg}</p>`;
    }

    let selectedLocation = null;

    function init() {
      window.geocoder = new google.maps.Geocoder();
      window.service = new google.maps.places.PlacesService(document.createElement('div'));

      const inputElem = document.getElementById('location');
      const autocomplete = new google.maps.places.Autocomplete(inputElem, {
        types: ['(regions)'],
        componentRestrictions: { country: 'in' }
      });

      autocomplete.addListener('place_changed', () => {
        const place = autocomplete.getPlace();
        if (place.geometry) {
          selectedLocation = place.geometry.location;
        }
      });
    }

    function searchByLocation() {
      const input = document.getElementById('location').value.trim();
      const pinRegex = /^\d{6}$/;
      if (!input) return displayError('Please enter a Bangalore pincode or locality.');
      if (pinRegex.test(input)) {
        geocodeAndSearch(input + ', Bangalore, India');
      } else if (selectedLocation) {
        runNearbySearch(selectedLocation);
      } else {
        geocodeAndSearch(input + ', Bangalore, India');
      }
    }

    function geocodeAndSearch(query) {
      displayError('Searching...');
      if (!window.geocoder) {
        displayError('Geocoder not initialized.');
        return;
      }
      window.geocoder.geocode({ address: query }, (results, status) => {
        console.log('Geocode status:', status, 'Results:', results);
        if (status === 'OK' && results && results[0]) {
          const f = results[0].formatted_address;
          if (!/Bengaluru|Bangalore/i.test(f)) {
            displayError('Location not in Bangalore.');
            return;
          }
          runNearbySearch(results[0].geometry.location);
        } else {
          displayError('Geocode failed: ' + status);
          console.error('Geocode response:', results, status);
        }
      });
    }

    function runNearbySearch(loc) {
      if (!window.service) {
        displayError('Places Service not initialized.');
        return;
      }
      // You can further increase the radius if you still get no results in some areas.
      window.service.nearbySearch(
        {
          location: loc,
          radius: 2000,
          type: ['restaurant']
        },
        (places, status) => {
          console.log("NearbySearch callback fired. Status:", status, "Places:", places);
          if (status === google.maps.places.PlacesServiceStatus.OK && places && places.length) {
            displayResults(places.sort(() => 0.5 - Math.random()).slice(0, 5));
          } else if (status === google.maps.places.PlacesServiceStatus.OK && (!places || !places.length)) {
            displayError('No restaurants found in this area.');
          } else if (status === google.maps.places.PlacesServiceStatus.ZERO_RESULTS) {
            displayError('No restaurants found in this area.');
          } else if (status === google.maps.places.PlacesServiceStatus.REQUEST_DENIED) {
            displayError('Request denied. Check your Google API key or billing.');
          } else {
            displayError('Error: ' + status);
            console.error('NearbySearch unexpected status:', status, places);
          }
        }
      );
    }

    function displayResults(arr) {
      const c = document.getElementById('results');
      c.innerHTML = '';
      arr.forEach(p => {
        const d = document.createElement('div');
        d.className = 'restaurant';

        const h = document.createElement('h3');
        h.textContent = p.name || 'No name found';
        d.appendChild(h);

        if (p.vicinity)
          d.appendChild(Object.assign(document.createElement('p'), { textContent: p.vicinity }));
        if (p.rating)
          d.appendChild(Object.assign(document.createElement('p'), { textContent: 'Rating: ' + p.rating + ' â˜…' }));

        c.appendChild(d);
      });
    }
  </script>
  <!-- Replace YOUR_API_KEY_HERE with your real Google Maps API key -->
  <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCYGiid19V7Ili-bMwLBY5UovOeetMJUnA&libraries=places&callback=init"></script>
</head>
<body>
  <header>
    <h1>Commun-Eat-Y</h1>
    <p class="tagline">Discover flavor. Share belonging.</p>
  </header>
  <main>
    <div class="categories">
      <h2>Collection</h2>
      <h2>Community</h2>
    </div>
    <section class="search-section">
      <input id="location" type="text" placeholder="Enter Bangalore pincode or locality" />
      <button onclick="searchByLocation()">Find 5 Random Restaurants</button>
    </section>
    <section id="results"></section>
  </main>
</body>
</html>
