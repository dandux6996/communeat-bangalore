<!perp>
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Commun-Eat-Y - Restaurant Finder</title>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      margin: 0;
      background: #FFF7F0;
      color: #2E2E2E;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    header {
      background: url('https://myloveofbaking.com/wp-content/uploads/2023/06/IMG_9500.jpg') center/cover no-repeat;
      color: white;
      text-align: center;
      padding: 6rem 1rem 2.5rem;
      position: relative;
    }
    header::after {
      content: "";
      position: absolute;
      top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 0;
    }
    header h1, header p {
      position: relative;
      z-index: 1;
      margin: 0;
    }
    .tagline {
      margin-top: 1rem;
      font-weight: 300;
      font-size: 1.5rem;
    }
    main {
      flex: 1;
      max-width: 880px;
      margin: 2rem auto 3rem;
      padding: 0 1rem;
    }
    .input-section {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 2rem;
    }
    .input-section input {
      flex: 1;
      padding: 1rem;
      font-size: 1rem;
      border: 2px solid #2E2E2E;
      border-radius: 4px;
      outline-offset: 2px;
    }
    .input-section input:focus {
      border-color: #D72638;
      outline: none;
    }
    .input-section button {
      padding: 1rem 2rem;
      font-size: 1rem;
      background: #D72638;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.2s ease;
    }
    .input-section button:hover {
      background: #b41c2d;
    }
    #results {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 1rem;
    }
    .restaurant {
      background: white;
      border-radius: 8px;
      padding: 1.25rem;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      transition: transform 0.15s ease;
      color: #2E2E2E;
    }
    .restaurant:hover {
      transform: translateY(-5px);
    }
    .restaurant h3 {
      margin: 0 0 0.5rem 0;
      font-size: 1.25rem;
    }
    .restaurant p {
      margin: 0.25rem 0;
      font-size: 1rem;
      line-height: 1.2;
    }
    .error-message {
      color: red;
      font-weight: 600;
      text-align: center;
      grid-column: 1 / -1;
    }
    @media (max-width: 768px) {
      header {
        padding: 3rem 1rem 1.5rem;
      }
      header h1 {
        font-size: 2.2rem;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>Commun-Eat-Y</h1>
    <p class="tagline">Discover flavor. Share belonging.</p>
  </header>
  <main>
    <div class="input-section">
      <input type="text" id="locationInput" placeholder="Enter Bangalore pincode or locality" aria-label="Enter Bangalore pincode or locality" />
      <button id="searchButton" type="button">Find 5 Random Restaurants</button>
    </div>
    <div id="results"></div>
  </main>
  <script>
    // Geoapify API key (replace YOUR_GEOAPIFY_API_KEY with your valid key)
    const GEOAPIFY_API_KEY = 'YOUR_GEOAPIFY_API_KEY';

    const searchButton = document.getElementById('searchButton');
    const locationInput = document.getElementById('locationInput');
    const resultsContainer = document.getElementById('results');

    function clearResults() {
      resultsContainer.innerHTML = '';
    }

    function showError(message) {
      clearResults();
      const errorEl = document.createElement('p');
      errorEl.className = 'error-message';
      errorEl.textContent = message;
      resultsContainer.appendChild(errorEl);
    }

    function createRestaurantCard(restaurant) {
      const div = document.createElement('div');
      div.className = 'restaurant';
      const name = restaurant.name || 'Unnamed Restaurant';
      const address = restaurant.address_line1 || restaurant.address || '';
      const rating = restaurant.rate || restaurant.rating || null;

      div.innerHTML = `
        <h3>${name}</h3>
        <p>${address}</p>
        ${rating ? `<p>Rating: ${rating} â˜…</p>` : ''}
      `;
      return div;
    }

    async function locateAndShowRestaurants() {
      const location = locationInput.value.trim();
      clearResults();

      if (!location) {
        showError('Please enter a Bangalore pincode or locality.');
        return;
      }

      try {
        // Forward Geocode to get lat/lon
        const geocodeUrl = `https://api.geoapify.com/v1/geocode/search?text=${encodeURIComponent(location + ', Bangalore, India')}&apiKey=${GEOAPIFY_API_KEY}`;

        const geoResponse = await fetch(geocodeUrl);
        if (!geoResponse.ok) {
          throw new Error('Failed to geocode location.');
        }
        const geoData = await geoResponse.json();

        if (!geoData.features || geoData.features.length === 0) {
          showError('Could not find your location. Please enter a valid Bangalore pincode or locality.');
          return;
        }

        const { lat, lon } = geoData.features[0].properties;

        // Define bounding box around the location to search restaurants (approx 2km x 2km box)
        // bbox param format: left,bottom,right,top -> left = lon-0.02, bottom = lat-0.02, right = lon+0.02, top = lat+0.02
        const bbox = `${lon - 0.02},${lat - 0.02},${lon + 0.02},${lat + 0.02}`;

        const restaurantsUrl = `https://api.geoapify.com/v2/places?categories=catering.restaurant&filter=rect:${bbox}&limit=10&apiKey=${586ca97c3afc4e8b9dcb5bd4fc149cc2}`;

        const resResponse = await fetch(restaurantsUrl);
        if (!resResponse.ok) {
          throw new Error('Failed to fetch restaurants.');
        }
        const resData = await resResponse.json();

        const restaurants = resData.features || [];

        if (restaurants.length === 0) {
          showError('No restaurants found near this location.');
          return;
        }

        // Pick up to 5 random restaurants
        const selected = restaurants.sort(() => 0.5 - Math.random()).slice(0, 5);

        clearResults();
        selected.forEach(r => {
          resultsContainer.appendChild(createRestaurantCard(r.properties));
        });

      } catch (error) {
        showError(error.message);
        console.error(error);
      }
    }

    searchButton.addEventListener('click', locateAndShowRestaurants);
  </script>
</body>
</html>
