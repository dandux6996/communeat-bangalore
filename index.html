<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Commun-EAT-y — Location (no map) & Route (input only)</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; }
    :root{
      --primary:#FF6F61; --secondary:#6B5B95; --accent:#88B04B;
      --bg:#fafafa; --card:#fff; --text:#222; --muted:#666; --radius:8px;
    }
    body{font-family:'Poppins',sans-serif;margin:0;background:var(--bg);color:var(--text)}
    header{background:linear-gradient(135deg,var(--primary),var(--secondary));color:#fff;padding:22px;text-align:center}
    header h1{margin:0;font-size:22px}
    main{max-width:1100px;margin:20px auto;padding:14px}
    .mode-picker{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px;max-width:760px;margin:0 auto 18px}
    .mode-card{background:var(--card);border-radius:10px;padding:14px;border:1px solid #eee;text-align:center;cursor:pointer}
    .controls{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-bottom:12px}
    .controls input,.controls select,.controls button{padding:10px;border-radius:8px;border:1px solid #ccc}
    .controls button{background:var(--accent);color:#fff;border:none;cursor:pointer}
    .status{font-style:italic;text-align:center;margin-top:8px;color:var(--muted)}
    .error{color:#c0392b}
    table{width:100%;border-collapse:collapse;background:var(--card);border-radius:8px;overflow:hidden;margin-top:12px}
    thead th{background:var(--primary);color:#fff;padding:12px;text-align:left}
    td,th{padding:12px;border-bottom:1px solid #f1f1f1}
    tbody tr:hover{background:#fafafa}
    .overview{font-size:0.9rem;color:#555;margin-top:6px}
    .menu-link{background:var(--secondary);color:#fff;padding:6px 8px;border-radius:6px;text-decoration:none}
    .menu-link:hover{background:var(--primary)}
    .sidebar{background:var(--card);border-radius:8px;padding:12px;box-shadow:0 6px 18px rgba(0,0,0,0.05)}
    .route-form{display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:center}
    @media(max-width:820px){ .route-form{flex-direction:column} }
  </style>
</head>
<body>
  <header>
    <h1>Commun-EAT-y</h1>
    <div style="font-weight:300">Find restaurants by location — or enter a route (inputs only)</div>
  </header>

  <main>
    <section class="mode-picker" id="mode-picker">
      <div id="pick-location" class="mode-card" role="button" tabindex="0">
        <h2>Location</h2>
        <p style="margin:6px 0 0">Search top restaurants in a Bangalore area (no map).</p>
      </div>
      <div id="pick-route" class="mode-card" role="button" tabindex="0">
        <h2>Route</h2>
        <p style="margin:6px 0 0">Enter start & end — inputs only (no map).</p>
      </div>
    </section>

    <!-- LOCATION MODE (no map) -->
    <section id="location-mode" class="hidden">
      <div class="controls" aria-label="Location controls">
        <input id="location-input" placeholder="Enter Bangalore address / locality / pincode" style="min-width:240px" />
        <select id="cuisine-select" aria-label="Cuisine">
          <option value="">Any cuisine</option>
          <option>American</option><option>Asian</option><option>Bakery</option><option>Bar</option><option>BBQ</option>
          <option>Breakfast</option><option>Brazilian</option><option>British</option><option>Buffets</option><option>Café</option>
          <option>Caribbean</option><option>Chinese</option><option>Coffee</option><option>Comfort Food</option><option>Desserts</option>
          <option>Dim Sum</option><option>European</option><option>Fast Food</option><option>French</option><option>German</option>
          <option>Greek</option><option>Indian</option><option>Italian</option><option>Japanese</option><option>Korean</option>
          <option>Latin American</option><option>Malaysian</option><option>Mediterranean</option><option>Mexican</option>
          <option>Middle Eastern</option><option>Pizza</option><option>Seafood</option><option>Spanish</option><option>Steakhouse</option>
          <option>Sushi</option><option>Tapas</option><option>Thai</option><option>Vegetarian</option><option>Vietnamese</option>
        </select>
        <select id="price-select" aria-label="Price">
          <option value="">Any price</option>
          <option value="0">₹ (Budget)</option>
          <option value="1">₹₹</option>
          <option value="2">₹₹₹</option>
          <option value="3">₹₹₹₹</option>
          <option value="4">₹₹₹₹₹</option>
        </select>
        <button id="search-btn">Search</button>
      </div>

      <div id="location-status" class="status">Enter a location and click Search.</div>

      <table id="restaurant-table" class="hidden" aria-hidden="true">
        <thead><tr><th>Restaurant</th><th>Rating / Reviews</th><th style="width:18%">Address</th><th>Menu</th></tr></thead>
        <tbody></tbody>
      </table>
    </section>

    <!-- ROUTE MODE (inputs only) -->
    <section id="route-mode" class="hidden">
      <div class="sidebar" style="margin-bottom:12px">
        <form id="route-form" class="route-form" onsubmit="return false;">
          <input id="route-start" placeholder="Start (city or address)" style="min-width:200px" />
          <input id="route-end" placeholder="End (city or address)" style="min-width:200px" />
          <button id="route-submit" type="button">Submit Route</button>
          <button id="route-back" type="button" style="background:#eee;color:#111;border:1px solid #ddd">Back</button>
        </form>
        <div id="route-feedback" class="status" style="margin-top:10px">Enter start and destination and click Submit.</div>
      </div>
    </section>
  </main>

  <script>
    // Keep Location mode functionality but remove any map usage.
    // We'll still use Google Geocoder and Places (instantiated with a DIV) for geocoding & nearbySearch.

    // Initialize Google services when the API loads
    let geocoder, placesService;

    function initServices() {
      geocoder = new google.maps.Geocoder();
      // PlacesService can be attached to a dummy div
      placesService = new google.maps.places.PlacesService(document.createElement('div'));
    }

    // Mode picker wiring
    const pickLocation = document.getElementById('pick-location');
    const pickRoute = document.getElementById('pick-route');
    const modePicker = document.getElementById('mode-picker');
    const locationMode = document.getElementById('location-mode');
    const routeMode = document.getElementById('route-mode');

    pickLocation.addEventListener('click', () => {
      modePicker.classList.add('hidden');
      routeMode.classList.add('hidden');
      locationMode.classList.remove('hidden');
    });
    pickLocation.addEventListener('keypress', (e)=>{ if(e.key==='Enter' || e.key===' ') { pickLocation.click(); } });

    pickRoute.addEventListener('click', () => {
      modePicker.classList.add('hidden');
      locationMode.classList.add('hidden');
      routeMode.classList.remove('hidden');
      document.getElementById('route-feedback').textContent = 'Enter start & end and click Submit.';
    });
    pickRoute.addEventListener('keypress', (e)=>{ if(e.key==='Enter' || e.key===' ') { pickRoute.click(); } });

    // Hook "Back" in route to return to mode picker
    document.getElementById('route-back').addEventListener('click', () => {
      routeMode.classList.add('hidden');
      modePicker.classList.remove('hidden');
    });

    // Location mode: search
    document.getElementById('search-btn').addEventListener('click', onSearchClick);

    function onSearchClick() {
      const address = document.getElementById('location-input').value.trim();
      const cuisine = document.getElementById('cuisine-select').value;
      const price = document.getElementById('price-select').value;
      const statusEl = document.getElementById('location-status');
      const table = document.getElementById('restaurant-table');
      const tbody = table.querySelector('tbody');
      tbody.innerHTML = '';
      table.classList.add('hidden');
      table.setAttribute('aria-hidden', 'true');
      statusEl.textContent = '';
      if (!address) {
        statusEl.textContent = 'Please enter a location.';
        statusEl.className = 'status error';
        return;
      }
      statusEl.textContent = 'Geocoding...';
      geocoder.geocode({ address }, (results, geocodeStatus) => {
        if (geocodeStatus !== 'OK' || !results || !results[0]) {
          statusEl.textContent = 'Could not find that location.';
          statusEl.className = 'status error';
          return;
        }
        statusEl.textContent = 'Searching for top-rated restaurants with >200 reviews...';
        const loc = results[0].geometry.location;
        findTopRatedNoMap(loc, cuisine, price);
      });
    }

    function findTopRatedNoMap(location, cuisine, price) {
      const request = { location, radius: 3000, type: 'restaurant' };
      if (cuisine) request.keyword = cuisine;
      const selectedPrice = (price !== '' && price !== null && typeof price !== 'undefined') ? parseInt(price, 10) : null;
      placesService.nearbySearch(request, (results, status) => {
        const statusEl = document.getElementById('location-status');
        const table = document.getElementById('restaurant-table');
        const tbody = table.querySelector('tbody');
        if (status !== 'OK' || !results || !results.length) {
          statusEl.textContent = 'No restaurants found.';
          statusEl.className = 'status error';
          return;
        }

        const filtered = results
          .filter(r => typeof r.rating === 'number' && (r.user_ratings_total || 0) > 200 && (selectedPrice === null || r.price_level === selectedPrice))
          .sort((a, b) => b.rating - a.rating || (b.user_ratings_total || 0) - (a.user_ratings_total || 0));
        const top5 = filtered.slice(0, 5);

        // populate table (no map)
        tbody.innerHTML = '';
        top5.forEach(place => {
          const tr = document.createElement('tr');
          const menuUrl = `https://www.google.com/maps/search/?api=1&query=menu&query_place_id=${place.place_id}`;
          tr.innerHTML =
            `<td><strong>${escapeHtml(place.name)}</strong><div class="overview" id="ov-${place.place_id}"></div></td>` +
            `<td>${(place.rating||'N/A')}<br/>${place.user_ratings_total || 0} reviews</td>` +
            `<td>${escapeHtml(place.vicinity || place.formatted_address || '')}</td>` +
            `<td><a class="menu-link" href="${menuUrl}" target="_blank" rel="noreferrer">View Menu</a></td>`;
          tbody.appendChild(tr);
          // fetch editorial_summary if available
          placesService.getDetails({ placeId: place.place_id, fields: ['editorial_summary'] }, (detail, dStatus) => {
            if (dStatus === google.maps.places.PlacesServiceStatus.OK && detail && detail.editorial_summary && detail.editorial_summary.overview) {
              const el = document.getElementById(`ov-${place.place_id}`);
              if (el) el.textContent = detail.editorial_summary.overview;
            }
          });
        });

        table.classList.remove('hidden');
        table.removeAttribute('aria-hidden');
        statusEl.textContent = `Showing top ${top5.length} restaurants by rating with >200 reviews.`;
        statusEl.className = 'status';
      });
    }

    // Route mode: accept inputs only
    document.getElementById('route-submit').addEventListener('click', () => {
      const s = document.getElementById('route-start').value.trim();
      const e = document.getElementById('route-end').value.trim();
      const fb = document.getElementById('route-feedback');
      if (!s || !e) {
        fb.textContent = 'Please enter both start and end.';
        fb.className = 'status error';
        return;
      }
      fb.className = 'status';
      fb.textContent = `Route accepted: Start = "${s}" → End = "${e}". (No map displayed in this mode.)`;
    });

    // small HTML escape
    function escapeHtml(s) {
      if (!s) return '';
      return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
    }

    // Initialize Google services after maps JS loads
    window.initMap = function() {
      initServices();
      // no map to render, but services are ready
    };
  </script>

  <!-- Keep same API key used earlier; used for Geocoder & Places only -->
  <script async src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDqKeq3a0O__Mm7EQLy0zrHYuJUq8Ly1Ps&libraries=places&callback=initMap"></script>
</body>
</html>
